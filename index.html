<!DOCTYPE html>
<html class="light" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>4Elements - Acceso √Årea Paciente</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#418b88",
                        "gold": "#b09e80", 
                        "background-light": "#f9f7f2", 
                        "background-dark": "#151d1c",
                        "accent": "#a68177",
                        "text-brand": "#412814",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"],
                        "serif": ["Playfair Display", "serif"],
                        "body": ["Montserrat", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "1rem", "lg": "2rem", "xl": "3rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Manrope', sans-serif; }
        .letter-spacing-widest { letter-spacing: 0.4em; }
        .code-input { letter-spacing: 0.2em; text-align: center; font-weight: bold; text-transform: uppercase; }
        
        /* Utilidades para ocultar/mostrar */
        .hidden-content { display: none !important; }
        .fade-in { animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Spinner de carga */
        .loader { border-top-color: #418b88; -webkit-animation: spinner 1s linear infinite; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark min-h-screen flex flex-col font-display">

    <div id="login-screen" class="fixed inset-0 z-[100] bg-background-light dark:bg-background-dark flex flex-col overflow-y-auto">
        
        <header class="w-full px-8 py-6 flex justify-between items-center">
            <div class="flex items-center gap-2 text-primary">
                <span class="text-xs md:text-sm font-bold tracking-[0.2em] uppercase text-[#6d7e7d]">4Elements Wellness Medical Center</span>
            </div>
            <div class="hidden md:flex items-center gap-4 text-[#6d7e7d] text-sm">
                <span class="material-symbols-outlined text-lg">shield_with_heart</span>
                <span>Acceso Seguro</span>
            </div>
        </header>

        <main class="flex-1 flex items-center justify-center p-4">
            <div class="w-full max-w-[500px]">
                <div class="bg-white dark:bg-[#1c2625] rounded-xl shadow-2xl overflow-hidden border-t-[8px] border-primary transition-all duration-300 relative">
                    
                    <div class="px-8 pt-12 pb-10 flex flex-col items-center">
                        <div class="flex flex-col items-center mb-8">
                            <div class="grid grid-cols-2 gap-0.5 mb-3 opacity-80 rotate-45">
                                <div class="w-3 h-3 border border-[#b09e80]"></div>
                                <div class="w-3 h-3 border border-[#b09e80]"></div>
                                <div class="w-3 h-3 border border-[#b09e80]"></div>
                                <div class="w-3 h-3 border border-[#b09e80]"></div>
                            </div>
                            <h1 class="text-[#131616] dark:text-white text-2xl font-light letter-spacing-widest uppercase text-center">
                                4 ELEMENTS
                            </h1>
                            <span class="text-[10px] tracking-[0.3em] uppercase text-[#b09e80] mt-1">Wellness Medical Center</span>
                        </div>
                        
                        <div class="h-[1px] w-12 bg-primary/30 mb-8"></div>
                        
                        <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-wider mb-8">
                            <span class="material-symbols-outlined text-sm">person_pin</span>
                            √ÅREA DEL PACIENTE
                        </div>

                        <div class="text-center mb-10">
                            <h2 class="text-[#131616] dark:text-gray-200 text-xl font-bold mb-2 font-serif tracking-wide">Bienvenido/a</h2>
                            <p class="text-[#6d7e7d] text-sm leading-relaxed max-w-[320px] mx-auto">
                                Por favor, introduce tu c√≥digo de acceso exclusivo para consultar tu plan.
                            </p>
                        </div>

                        <div class="w-full space-y-6">
                            <div class="flex flex-col gap-2">
                                <label class="text-[#131616] dark:text-gray-300 text-xs font-bold uppercase tracking-widest ml-4">
                                    C√ìDIGO PERSONAL
                                </label>
                                <div class="relative">
                                    <input id="pass-input" class="code-input w-full h-16 rounded-full border border-[#dee3e2] dark:border-gray-700 bg-white dark:bg-gray-800 text-xl text-[#131616] dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" type="password"/>
                                    <div class="absolute right-6 top-1/2 -translate-y-1/2 text-gray-300">
                                        <span class="material-symbols-outlined">lock</span>
                                    </div>
                                </div>
                            </div>

                            <div class="pt-4 relative">
                                <button id="btn-login" onclick="verificarCodigo()" class="w-full h-14 bg-primary hover:bg-primary/90 text-white rounded-full font-bold text-base tracking-widest shadow-lg shadow-primary/20 flex items-center justify-center gap-2 group transition-all">
                                    ENTRAR
                                    <span class="material-symbols-outlined text-lg group-hover:translate-x-1 transition-transform">arrow_forward</span>
                                </button>
                                
                                <div id="loading" class="hidden absolute inset-0 bg-white/80 dark:bg-black/50 flex items-center justify-center rounded-full z-10">
                                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6"></div>
                                </div>
                            </div>
                            
                            <p id="error-msg" class="text-red-500 text-xs font-bold text-center hidden animate-pulse">
                                C√≥digo incorrecto. Verif√≠calo e intenta de nuevo.
                            </p>
                        </div>

                        <div class="mt-8">
                            <a href="https://wa.me/34674201432?text=Hola, he olvidado mi c√≥digo de acceso al √°rea de paciente." target="_blank" class="text-[#6d7e7d] hover:text-primary text-sm font-medium transition-colors flex items-center gap-1">
                                <span class="material-symbols-outlined text-base">help</span>
                                ¬øHas olvidado tu c√≥digo?
                            </a>
                        </div>
                    </div>

                    <div class="bg-gray-50 dark:bg-black/20 px-8 py-4 border-t border-gray-100 dark:border-gray-800">
                        <div class="flex items-center justify-center gap-3 text-[11px] text-[#6d7e7d] uppercase tracking-widest font-semibold text-center">
                            <span class="material-symbols-outlined text-sm text-primary">verified_user</span>
                            <span>ENTORNO SEGURO Y ENCRIPTADO</span>
                        </div>
                    </div>
                </div>

                <footer class="mt-12 flex flex-col items-center gap-4 px-4 text-center pb-8">
                    <p class="text-[#6d7e7d] text-xs font-medium max-w-sm leading-relaxed">
                        Tu privacidad es nuestra prioridad. Este sistema utiliza protocolos avanzados de protecci√≥n de datos m√©dicos.
                    </p>
                </footer>
            </div>
        </main>
        
        <div class="fixed top-[-10%] right-[-10%] w-[40%] h-[40%] bg-primary/5 rounded-full blur-[100px] -z-10"></div>
        <div class="fixed bottom-[-10%] left-[-10%] w-[30%] h-[30%] bg-[#b09e80]/10 rounded-full blur-[80px] -z-10"></div>
    </div>

    <div id="app-content" class="hidden-content flex flex-col min-h-screen bg-[#ece6dd]">
        
        <header class="sticky top-0 z-50 w-full border-b border-primary/10 bg-white/90 backdrop-blur-md px-6 py-4">
            <div class="mx-auto max-w-5xl flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="text-primary">
                       <span class="material-symbols-outlined text-3xl">spa</span>
                    </div>
                    <div>
                        <h2 class="text-primary font-serif text-lg leading-none tracking-widest">4 ELEMENTS</h2>
                        <span class="text-[8px] text-accent font-bold uppercase tracking-[0.2em] block mt-1">Medical Center</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="location.reload()" class="hidden md:flex items-center gap-2 text-xs font-bold text-text-brand/50 hover:text-primary uppercase tracking-widest transition-colors">
                        <span class="material-symbols-outlined text-sm">logout</span> Salir
                    </button>
                    <div class="size-10 rounded-full bg-[#ece6dd] border border-primary/20 flex items-center justify-center text-primary/50">
                         <span class="material-symbols-outlined">person</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 pb-20 w-full max-w-4xl mx-auto px-6 lg:px-0 mt-8 font-body text-[#412814]">
            
            <section class="mb-12 text-center md:text-left">
                <p class="text-accent font-bold text-xs uppercase tracking-[0.2em] mb-2">Tu espacio personal</p>
                <h1 class="font-serif text-4xl md:text-5xl text-primary mb-4">
                    Hola, <span id="user-name">...</span>
                </h1>
                <p class="opacity-70 text-lg font-light max-w-2xl leading-relaxed">
                    "El equilibrio no es algo que encuentras, es algo que creas." <br>
                    Aqu√≠ tienes tu nueva planificaci√≥n para continuar tu camino hacia el bienestar.
                </p>
            </section>

            <section class="mb-12 shadow-xl rounded-xl overflow-hidden bg-white border border-white">
                <div class="flex flex-col md:flex-row">
                    <div class="w-full md:w-1/3 bg-primary/10 flex flex-col items-center justify-center p-8 text-primary border-r border-primary/5">
                         <span class="material-symbols-outlined text-6xl mb-2">nutrition</span>
                         <span class="text-xs font-bold uppercase tracking-widest opacity-60">Plan Activo</span>
                    </div>
                    
                    <div class="w-full md:w-2/3 p-8 md:p-10 flex flex-col justify-center">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="size-2 rounded-full bg-accent animate-pulse"></span>
                            <span id="active-date" class="text-[10px] font-bold uppercase tracking-widest opacity-50">...</span>
                        </div>
                        
                        <h3 class="font-serif text-3xl text-primary mb-2" id="active-title">Cargando...</h3>
                        <p class="opacity-70 text-sm mb-8 font-light">
                            Dise√±ado por la Dra. Mac√≠as y su equipo para tu momento actual.
                        </p>

                        <a id="active-pdf" href="#" target="_blank" class="w-full md:w-auto text-center bg-primary hover:bg-[#367270] text-white py-4 px-8 rounded-lg text-xs font-bold uppercase tracking-[0.2em] shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2">
                            <span class="material-symbols-outlined text-sm">download</span> Descargar PDF
                        </a>
                    </div>
                </div>
            </section>

            <section class="mb-16">
                <div class="flex items-center gap-4 mb-8">
                    <span class="material-symbols-outlined text-accent text-3xl">verified</span>
                    <h2 class="font-serif text-2xl">Pautas Maestras</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-8 rounded-xl border-l-4 border-primary shadow-sm">
                        <h4 class="font-bold text-primary text-xs uppercase tracking-widest mb-6">La Base (Tierra ‚õ∞Ô∏è)</h4>
                        <ul class="space-y-4">
                            <li class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-primary text-sm mt-0.5">check_circle</span>
                                <p class="opacity-70 text-sm"><strong>Prote√≠nas ilimitadas:</strong> Carne, pescado, huevo, sepia (cocci√≥n plancha/vapor).</p>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-primary text-sm mt-0.5">check_circle</span>
                                <p class="opacity-70 text-sm"><strong>Guarnici√≥n:</strong> 1/4 del plato (ensalada, verduras, setas).</p>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="bg-white p-8 rounded-xl border-l-4 border-accent shadow-sm">
                        <h4 class="font-bold text-accent text-xs uppercase tracking-widest mb-6">A Evitar (Fuego üî•)</h4>
                        <ul class="space-y-4">
                            <li class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-accent text-sm mt-0.5">cancel</span>
                                <p class="opacity-70 text-sm">Az√∫car, boller√≠a, refrescos (excepto light/sacarina).</p>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-accent text-sm mt-0.5">info</span>
                                <p class="opacity-70 text-sm"><strong>Fruta:</strong> M√°ximo 1 raci√≥n al d√≠a.</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="mb-20">
                <div class="flex items-center justify-between mb-8 border-b border-primary/10 pb-4">
                    <h2 class="font-serif text-2xl">Farmacia & Suplementaci√≥n</h2>
                    <span class="text-[10px] opacity-40 uppercase tracking-widest hidden md:block">Solicitar a Dra. Mac√≠as</span>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border border-transparent hover:border-primary/20 group">
                        <div class="h-12 w-12 bg-[#ece6dd] rounded-full flex items-center justify-center text-primary mb-4 group-hover:bg-primary group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined">medical_services</span>
                        </div>
                        <h4 class="font-serif text-lg text-primary mb-2">M√©todo PronoKal¬Æ</h4>
                        <p class="text-xs opacity-60 mb-6 min-h-[40px]">Reposici√≥n de productos bajo supervisi√≥n m√©dica.</p>
                        <a href="https://wa.me/34674201432?text=Hola Dra. Mac√≠as, necesito reponer productos PronoKal." target="_blank" class="block w-full text-center border border-primary text-primary py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest hover:bg-primary hover:text-white transition-all">
                            Solicitar
                        </a>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border border-transparent hover:border-primary/20 group">
                        <div class="h-12 w-12 bg-[#ece6dd] rounded-full flex items-center justify-center text-primary mb-4 group-hover:bg-primary group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined">medication</span>
                        </div>
                        <h4 class="font-serif text-lg text-primary mb-2">Micronutrici√≥n</h4>
                        <p class="text-xs opacity-60 mb-6 min-h-[40px]">Vitaminas, Omega 3 y drenantes espec√≠ficos.</p>
                        <a href="https://wa.me/34674201432?text=Hola Dra. Mac√≠as, quiero reponer mis suplementos." target="_blank" class="block w-full text-center border border-primary text-primary py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest hover:bg-primary hover:text-white transition-all">
                            Reponer
                        </a>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border border-transparent hover:border-primary/20 group">
                        <div class="h-12 w-12 bg-[#ece6dd] rounded-full flex items-center justify-center text-primary mb-4 group-hover:bg-primary group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined">inventory_2</span>
                        </div>
                        <h4 class="font-serif text-lg text-primary mb-2">Stock en Cl√≠nica</h4>
                        <p class="text-xs opacity-60 mb-6 min-h-[40px]">Snacks proteicos y batidos listos para llevar.</p>
                        <a href="https://wa.me/34674201432?text=Hola, ¬øqu√© snacks ten√©is disponibles en cl√≠nica?" target="_blank" class="block w-full text-center border border-primary text-primary py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest hover:bg-primary hover:text-white transition-all">
                            Consultar
                        </a>
                    </div>
                </div>
            </section>

            <footer class="border-t border-primary/10 py-10 flex flex-col md:flex-row justify-between items-center gap-6 opacity-60">
                <div class="text-center md:text-left">
                    <p class="text-sm font-bold text-primary">4 Elements Wellness Medical Center</p>
                    <p class="text-xs mt-1">Carrer de l‚ÄôAve Maria, 29, 17130 L‚ÄôEscala, Girona</p>
                </div>
            </footer>

        </main>
    </div>

    <script>
        // -------------------------------------------------------------
        // üëá PEGA AQU√ç TU ENLACE CSV DE GOOGLE SHEETS üëá
        // -------------------------------------------------------------
        const URL_EXCEL = https://docs.google.com/spreadsheets/d/e/2PACX-1vTtDe-3Hsg6FSo7SewPSgDvH5DpCOf9TF6rC4eisgrBoopjbLxSYLsX-lbWuAtlzTtadxzfsO-uic3k/pubhtml;
        // -------------------------------------------------------------

        function verificarCodigo() {
            const inputCode = document.getElementById('pass-input').value.trim().toUpperCase();
            const btn = document.getElementById('btn-login');
            const loading = document.getElementById('loading');
            const errorMsg = document.getElementById('error-msg');

            // UI: Mostrar carga
            btn.classList.add('opacity-50', 'pointer-events-none');
            loading.classList.remove('hidden');
            errorMsg.classList.add('hidden');

            Papa.parse(URL_EXCEL, {
                download: true,
                header: true,
                complete: function(results) {
                    const datos = results.data;
                    const historialPaciente = datos.filter(row => 
                        row.CODIGO && row.CODIGO.trim().toUpperCase() === inputCode
                    );

                    if (historialPaciente.length > 0) {
                        const ultimoPlan = historialPaciente[historialPaciente.length - 1];
                        renderizarPaciente(ultimoPlan);
                    } else {
                        // C√≥digo err√≥neo
                        loading.classList.add('hidden');
                        btn.classList.remove('opacity-50', 'pointer-events-none');
                        errorMsg.classList.remove('hidden');
                        // Resetear input visualmente
                        document.getElementById('pass-input').classList.add('border-red-500');
                    }
                },
                error: function() {
                    loading.classList.add('hidden');
                    errorMsg.innerText = "Error de conexi√≥n. Int√©ntalo de nuevo.";
                    errorMsg.classList.remove('hidden');
                    btn.classList.remove('opacity-50', 'pointer-events-none');
                }
            });
        }

        function renderizarPaciente(data) {
            document.getElementById('user-name').innerText = data.NOMBRE;
            document.getElementById('active-title').innerText = data.TITULO;
            document.getElementById('active-date').innerText = data.FECHA;
            document.getElementById('active-pdf').href = data.PDF;

            const loginScreen = document.getElementById('login-screen');
            const appContent = document.getElementById('app-content');
            
            // Animaci√≥n de salida del login
            loginScreen.style.transition = "opacity 0.8s ease";
            loginScreen.style.opacity = '0';
            
            setTimeout(() => {
                loginScreen.classList.add('hidden-content'); // Quitar login del DOM flow
                appContent.classList.remove('hidden-content'); // Mostrar app
                appContent.classList.add('fade-in'); // Animar entrada
            }, 800);
        }

        // Permitir Enter
        document.getElementById("pass-input").addEventListener("keypress", function(e) {
            if (e.key === "Enter") verificarCodigo();
        });
        
        // Quitar borde rojo al escribir
        document.getElementById("pass-input").addEventListener("input", function() {
            this.classList.remove('border-red-500');
            document.getElementById('error-msg').classList.add('hidden');
        });
    </script>
</body>
</html>
